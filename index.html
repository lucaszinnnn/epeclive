<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Contador de Espectadores ao Vivo</title>
<style>
  body {
    margin: 0;
    background: transparent;
    color: #fff;
    font-family: Arial, sans-serif;
    text-align: center;
    user-select: none;
  }
  .container {
    padding: 20px;
    background: rgba(0,0,0,0.5);
    border-radius: 10px;
    display: inline-block;
  }
  input[type="text"], input[type="password"] {
    width: 90%;
    padding: 8px;
    margin: 8px 0;
    border-radius: 5px;
    border: none;
    font-size: 1rem;
  }
  label {
    font-weight: bold;
    display: block;
    margin-top: 10px;
  }
  button {
    background-color: #1E90FF;
    color: white;
    border: none;
    padding: 12px 25px;
    font-size: 1.2rem;
    border-radius: 8px;
    margin-top: 15px;
    cursor: pointer;
  }
  button:hover {
    background-color: #0b70e0;
  }
  #totalViewers {
    font-size: 6rem;
    margin-top: 20px;
    text-shadow: 2px 2px 5px black;
  }
  small {
    color: #ddd;
  }
</style>
</head>
<body>

<div class="container">
  <h1>Contador de Espectadores ao Vivo</h1>

  <label for="youtubeLink">Link da Live YouTube:</label>
  <input type="text" id="youtubeLink" placeholder="Cole o link da live do YouTube" />

  <label for="kickViewers">Espectadores Kick (teste):</label>
  <input type="number" id="kickViewers" placeholder="Número fixo para Kick" value="0" />

  <label for="tiktokViewers">Espectadores TikTok (teste):</label>
  <input type="number" id="tiktokViewers" placeholder="Número fixo para TikTok" value="0" />

  <label for="apiKey">Google API Key (YouTube Data API v3):</label>
  <input type="password" id="apiKey" placeholder="Sua chave API Google" />

  <button id="updateBtn">Atualizar Contagem</button>
  <button id="demoBtn">Modo Demo</button>

  <div id="totalViewers">0</div>
  <small>Espectadores ao vivo</small>
</div>

<script>
  async function getYoutubeLiveViewers(videoId, apiKey) {
    if (!apiKey) return 0;

    try {
      const url = `https://www.googleapis.com/youtube/v3/videos?part=liveStreamingDetails&id=${videoId}&key=${apiKey}`;
      const response = await fetch(url);
      const data = await response.json();
      if (data.items && data.items.length > 0) {
        const viewers = data.items[0].liveStreamingDetails.concurrentViewers;
        return viewers ? parseInt(viewers) : 0;
      }
      return 0;
    } catch (e) {
      console.error('Erro ao buscar dados do YouTube:', e);
      return 0;
    }
  }

  function extractYoutubeVideoId(url) {
    // Pega o videoId de URLs padrões do YouTube
    const regex = /(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|live\/|embed\/|v\/))([\w-]{11})/;
    const match = url.match(regex);
    return match ? match[1] : null;
  }

  async function updateCount() {
    const ytLink = document.getElementById('youtubeLink').value.trim();
    const kickCount = parseInt(document.getElementById('kickViewers').value) || 0;
    const tiktokCount = parseInt(document.getElementById('tiktokViewers').value) || 0;
    const apiKey = document.getElementById('apiKey').value.trim();

    let ytViewers = 0;

    const videoId = extractYoutubeVideoId(ytLink);
    if (videoId && apiKey) {
      ytViewers = await getYoutubeLiveViewers(videoId, apiKey);
    }

    const total = ytViewers + kickCount + tiktokCount;

    document.getElementById('totalViewers').textContent = total.toLocaleString();
  }

  function demoMode() {
    const ytDemo = Math.floor(Math.random() * 1000);
    const kickDemo = Math.floor(Math.random() * 500);
    const tiktokDemo = Math.floor(Math.random() * 700);

    document.getElementById('youtubeLink').value = '';
    document.getElementById('apiKey').value = '';
    document.getElementById('kickViewers').value = kickDemo;
    document.getElementById('tiktokViewers').value = tiktokDemo;
    document.getElementById('totalViewers').textContent = (ytDemo + kickDemo + tiktokDemo).toLocaleString();
  }

  document.getElementById('updateBtn').addEventListener('click', updateCount);
  document.getElementById('demoBtn').addEventListener('click', demoMode);
</script>

</body>
</html>
